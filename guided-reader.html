<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Guided Reader — Philolog</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Montserrat:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Minimal base and header styles copied from index.html to ensure visual parity */
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Montserrat','Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;color:#1f2937;background:#fff;line-height:1.6}
    .top-nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,0,0,0.08);padding:0 2rem;height:64px}
    .nav-container{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:100%}
    .nav-logo{display:flex;align-items:center;gap:.5rem;font-weight:600;text-decoration:none;color:inherit;font-family:'Lora',serif}
    .logo-icon{width:32px;height:32px;background:#3b82f6;border-radius:6px;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold}

    /* Framed section styles */
    .framed-section{position:relative;padding:80px 0;overflow:visible}
    .framed-section::before{content:'';position:absolute;inset:0;background-image:url('./public/images/guided-reader-pic.jpg');background-size:cover;background-position:center;opacity:.8;filter:brightness(.85);z-index:0}
  /* Make the white card slightly translucent so the background image shows through subtly */
  .framed-section .framed-card{position:relative;z-index:1;max-width:1140px;margin:0 auto;background:rgba(255,255,255,0.90);border-radius:30px;box-shadow:0 10px 30px rgba(16,24,40,0.08);padding:48px;display:block}

    /* Responsive spacing */
    @media (max-width:768px){.framed-section{padding:40px 0}.framed-section .framed-card{padding:24px;margin:0 16px;border-radius:22px}}

    /* Guided Reader controls */
    .controls{display:flex;gap:1rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap}
    .control-group{display:flex;flex-direction:column;gap:.5rem}
    label{font-size:.9rem;color:#374151;font-weight:600}

  /* Combobox (custom select) styling */
  .combobox{min-width:260px;position:relative;font-family:inherit}
  .combo-control{display:flex;align-items:center;justify-content:space-between;gap:.5rem;border:1px solid #e5e7eb;padding:.6rem .9rem;border-radius:10px;background:#fff;cursor:pointer;min-height:44px}
  .combo-control:focus{outline:3px solid rgba(59,130,246,0.28);outline-offset:2px}
  .combo-value{color:#0f172a}
  .combo-chev{width:18px;height:18px;opacity:.75}
  .combo-panel{position:absolute;left:0;right:0;top:calc(100% + 8px);background:#fff;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.08);z-index:50;padding:.5rem;max-height:320px;overflow:auto}
  .combo-search{width:100%;padding:.5rem .6rem;border-radius:8px;border:1px solid #e6eefc;margin-bottom:.5rem}
  .combo-list{list-style:none;padding:0;margin:0}
  .combo-item{padding:.5rem .6rem;border-radius:8px;cursor:pointer}
  .combo-item[aria-selected="true"],.combo-item:hover{background:#eef2ff}


  /* Circular toggle (explicit sizing and containment) */
  .circle-toggle{width:120px;height:120px;border-radius:9999px;display:flex;align-items:center;justify-content:center;text-align:center;border:2px solid rgba(59,130,246,0.35);background:transparent;color:#0f172a;padding:.5rem;cursor:pointer;overflow:hidden}
  .circle-toggle .line{display:block;line-height:1;font-size:.92rem}
  .circle-toggle.on{background:#3b82f6;color:white;border-color:#2563eb}
  .circle-toggle:focus{outline:3px solid rgba(59,130,246,0.35);outline-offset:4px}
  @media (max-width:768px){.circle-toggle{width:96px;height:96px}.circle-toggle .line{font-size:.85rem}}

    /* Content placeholder styling */
    .framed-card__content{background:transparent}
    .reader-placeholder{min-height:320px;border-radius:12px;border:1px dashed #e6eefc;padding:2rem;color:#0f172a;background:#fff}

    /* Utilities */
    .container{max-width:1400px;margin:0 auto;padding:0 2rem}
    .brand-stack{display:flex;flex-direction:column;align-items:flex-start;gap:.25rem}
  </style>
</head>
<body>
  <!-- Header (reuse landing header markup) -->
  <nav class="top-nav">
    <div class="nav-container">
      <a href="/" class="nav-logo">
        <div class="logo-icon">Φ</div>
        <span>Philolog</span>
      </a>
      <!-- keep nav links minimal to match landing page -->
      <ul class="nav-links" style="display:flex;gap:1rem;list-style:none">
        <li><a href="/" style="text-decoration:none;color:inherit">Home</a></li>
      </ul>
    </div>
  </nav>

  <!-- Framed card section -->
  <section class="framed-section" style="margin-top:64px">
    <div class="framed-card">
      <div class="framed-card__content">
        <!-- Controls Row -->
        <div class="controls" role="toolbar" aria-label="Reader controls">
          <div class="control-group">
            <label for="combo-control">Select text</label>
            <div class="combobox" id="combo" aria-haspopup="listbox">
              <div id="combo-control" class="combo-control" role="combobox" aria-expanded="false" tabindex="0" aria-controls="combo-list">
                <span class="combo-value">Select text</span>
                <svg class="combo-chev" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 8l4 4 4-4" stroke="#0f172a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div id="combo-panel" class="combo-panel" hidden>
                <input id="combo-search" class="combo-search" placeholder="Search texts…" aria-label="Search texts" />
                <ul id="combo-list" class="combo-list" role="listbox" tabindex="-1"></ul>
              </div>
            </div>
          </div>

          <div class="control-group">
            <button id="pos-toggle" class="circle-toggle" aria-pressed="false" aria-label="Highlight parts of speech off">
              <span class="line">Highlight</span>
              <span class="line">parts of</span>
              <span class="line">speech</span>
            </button>
          </div>
        </div>

        <!-- Reader mount point -->
        <div class="reader-placeholder" id="guided-reader-root">
          <!-- The actual Guided Reader component should mount here -->
          <strong>Guided Reader</strong>
          <p style="margin-top:.5rem;color:#374151">This area is a layout shell. Mount your Guided Reader component inside <code>.framed-card__content</code>.</p>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Allowed list of text JSON files to populate the combobox
    (function(){
      const texts = [
        'glory_to_the_father.json',
        'heavenly_king.json',
        'it_is_truly_meet.json',
        'jesus_prayer.json',
        'kyrie_eleison.json',
        'lords_prayer.json',
        'phos_hilaron.json',
        'psalm_50_part1.json',
        'psalm_50_part2.json',
        'psalm_50_part3.json',
        'the_creed.json',
        'trisagion.json',
        'troparion_nativity.json',
        'troparion_pascha.json',
        'troparion_theophany.json'
      ];

      // Human-friendly display for filenames
      function friendlyName(fn){
        const name = fn.replace(/\.json$/i,'');
        if(/^psalm_50_part(\d+)$/i.test(name)){
          const part = name.match(/^psalm_50_part(\d+)$/i)[1];
          return `Psalm 50 — Part ${part}`;
        }
        // Replace underscores with spaces and Title Case
        return name.split('_').map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(' ');
      }

      // Combobox behavior
      const comboControl = document.getElementById('combo-control');
      const comboPanel = document.getElementById('combo-panel');
      const comboList = document.getElementById('combo-list');
      const comboSearch = document.getElementById('combo-search');
      const comboValue = document.querySelector('.combo-value');

      let filtered = texts.slice();
      let highlighted = -1;
      let selected = null;

      function renderList(){
        comboList.innerHTML = '';
        filtered.forEach((fn,i)=>{
          const li = document.createElement('li');
          li.className = 'combo-item';
          li.setAttribute('role','option');
          li.setAttribute('data-fn',fn);
          li.tabIndex = -1;
          li.textContent = friendlyName(fn);
          li.addEventListener('click', ()=> selectIndex(i));
          li.addEventListener('mousemove', ()=> setHighlight(i));
          comboList.appendChild(li);
        });
        updateHighlight();
      }

      function openPanel(){
        comboPanel.hidden = false;
        comboControl.setAttribute('aria-expanded','true');
        comboSearch.focus();
      }
      function closePanel(){
        comboPanel.hidden = true;
        comboControl.setAttribute('aria-expanded','false');
        highlighted = -1;
        updateHighlight();
      }

      function setHighlight(i){
        highlighted = i;
        updateHighlight();
      }

      function updateHighlight(){
        const items = comboList.querySelectorAll('.combo-item');
        items.forEach((it,idx)=>{
          const sel = idx===highlighted;
          it.setAttribute('aria-selected', sel ? 'true' : 'false');
          if(sel) it.scrollIntoView({block:'nearest'});
        });
      }

      function selectIndex(i){
        const fn = filtered[i];
        if(!fn) return;
        selected = fn;
        comboValue.textContent = friendlyName(fn);
        // Map selection to wherever the app needs it; store filename on data attribute
        comboControl.dataset.value = fn;
        closePanel();
      }

      comboControl.addEventListener('click', ()=>{
        if(comboPanel.hidden) openPanel(); else closePanel();
      });

      comboControl.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowDown'){ e.preventDefault(); openPanel(); setHighlight(0); }
        if(e.key === 'ArrowUp'){ e.preventDefault(); openPanel(); setHighlight(filtered.length-1); }
        if(e.key === 'Enter'){ e.preventDefault(); if(comboPanel.hidden) openPanel(); else if(highlighted>=0) selectIndex(highlighted); }
        if(e.key === 'Escape'){ closePanel(); }
      });

      comboSearch.addEventListener('input', ()=>{
        const q = comboSearch.value.trim().toLowerCase();
        filtered = texts.filter(fn=>friendlyName(fn).toLowerCase().includes(q));
        highlighted = filtered.length?0:-1;
        renderList();
      });

      comboSearch.addEventListener('keydown', (e)=>{
        const items = comboList.querySelectorAll('.combo-item');
        if(e.key === 'ArrowDown'){ e.preventDefault(); if(highlighted < items.length-1) setHighlight(highlighted+1); }
        if(e.key === 'ArrowUp'){ e.preventDefault(); if(highlighted > 0) setHighlight(highlighted-1); }
        if(e.key === 'Enter'){ e.preventDefault(); if(highlighted>=0) selectIndex(highlighted); }
        if(e.key === 'Escape'){ closePanel(); comboControl.focus(); }
      });

      // Close on outside click
      document.addEventListener('click', (e)=>{
        if(!document.getElementById('combo').contains(e.target)) closePanel();
      });

      // Initial render
      filtered = texts.slice();
      renderList();

      // Circular toggle behavior (kept simple, presentation only)
      const btn = document.getElementById('pos-toggle');
      btn.addEventListener('click', function(){
        const isOn = btn.classList.toggle('on');
        btn.setAttribute('aria-pressed', isOn ? 'true' : 'false');
        btn.setAttribute('aria-label', isOn ? 'Highlight parts of speech on' : 'Highlight parts of speech off');
      });
      btn.addEventListener('keydown', function(e){ if(e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); btn.click(); } });

    })();
  </script>
</body>
</html>
